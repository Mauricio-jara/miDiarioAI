---
export const prerender = false;
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/ui/Navbar.astro";
import EmotionStats from "../components/dashboard/EmotionStats.jsx";
import createSupabaseClient from "../lib/supabase"; // Importar cliente

const supabase = createSupabaseClient(Astro);
const { data } = await supabase.auth.getSession();
const accessToken = data.session?.access_token ?? null;

if (!accessToken) {
    return Astro.redirect("/login");
}

const nombre = data.session?.user?.user_metadata?.nombre ?? "Usuario";
---

<Layout nombre={nombre}>
    <Navbar nombre={nombre} />
    <section class="flex justify-center">
        <div class="w-full max-w-3xl">
            {/* Pasamos el token como prop */}
            <EmotionStats client:load accessToken={accessToken} />
        </div>
    </section>
</Layout>